package com.example.prepexam

import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory
import retrofit2.http. GET
import retrofit2.http. Path

// Interface defining API endpoints
interface PizzaApiService {
    // GET request to fetch menu - returns List<Pizza> directly
    @GET("restaurants/restaurantId/menu?category=Pizza&orderBy=rank")
    suspend fun getMenu(): List<Pizza>

    // Search pizzas by name only
    @GET("pizzas/search/{pizzaName}")
    suspend fun searchPizzaByName(
        @Path("pizzaName") pizzaName: String
    ): List<Pizza>

    // Search pizzas by restaurant ID
    @GET("restaurants/{restaurantId}/menu")
    suspend fun searchPizzaByRestaurant(
        @Path("restaurantId") restaurantId: String
    ): List<Pizza>

    companion object {
        private const val BASE_URL = "https://private-ca2774-pizzaapp. apiary-mock.com/"

        // Create Retrofit instance
        fun create(): PizzaApiService {
            val retrofit = Retrofit.Builder()
                .baseUrl(BASE_URL)
                . addConverterFactory(GsonConverterFactory.create())
                . build()

            return retrofit.create(PizzaApiService::class.java)
        }
    }
}







<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas. android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:padding="8dp">

        <com.google.android.material.textfield.TextInputLayout
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:layout_marginEnd="4dp">

            <com.google.android.material.textfield. TextInputEditText
                android:id="@+id/searchPizzaName"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:hint="Pizza name" />
        </com. google.android.material.textfield.TextInputLayout>

        <com.google.android.material. textfield.TextInputLayout
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:layout_marginStart="4dp">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/searchRestaurantId"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:hint="Restaurant ID" />
        </com.google.android.material.textfield.TextInputLayout>
    </LinearLayout>

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:padding="8dp">

        <com.google.android.material.button.MaterialButton
            android:id="@+id/searchButton"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:layout_marginEnd="4dp"
            android:text="Search"/>

        <com.google.android.material.button.MaterialButton
            android:id="@+id/loadAllButton"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:layout_marginEnd="4dp"
            android:text="Load All"/>

        <com.google.android. material.button.MaterialButton
            android:id="@+id/settingsButton"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:layout_marginEnd="4dp"
            android:text="Settings"/>

        <com.google.android. material.button.MaterialButton
            android:id="@+id/logoutButton"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:layout_marginStart="4dp"
            android:text="Logout"/>
    </LinearLayout>

    <androidx.recyclerview.widget.RecyclerView
        android:id="@+id/pizzaRecyclerView"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"/>

</LinearLayout>


package com.example.prepexam

import android.content.Intent
import android.os. Bundle
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import androidx.lifecycle.lifecycleScope
import androidx.recyclerview.widget.LinearLayoutManager
import androidx.recyclerview.widget.RecyclerView
import com.google.android.material.button.MaterialButton
import com.google.android.material.textfield.TextInputEditText
import kotlinx.coroutines.launch

class MainActivity : AppCompatActivity() {

    private lateinit var recyclerView: RecyclerView
    private lateinit var adapter: PizzaAdapter
    private lateinit var searchPizzaNameInput: TextInputEditText
    private lateinit var searchRestaurantIdInput: TextInputEditText
    private lateinit var searchButton: MaterialButton
    private lateinit var loadAllButton: MaterialButton
    private val apiService = PizzaApiService. create()

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        // Initialize views
        recyclerView = findViewById(R.id.pizzaRecyclerView)
        searchPizzaNameInput = findViewById(R.id.searchPizzaName)
        searchRestaurantIdInput = findViewById(R.id. searchRestaurantId)
        searchButton = findViewById(R.id.searchButton)
        loadAllButton = findViewById(R.id. loadAllButton)

        // Setup RecyclerView
        recyclerView.layoutManager = LinearLayoutManager(this)
        adapter = PizzaAdapter(emptyList())
        recyclerView.adapter = adapter

        // Setup button listeners
        searchButton.setOnClickListener { performSearch() }
        loadAllButton.setOnClickListener { loadMenu() }

        // Load menu on startup
        loadMenu()
    }

    // Perform search based on user input
    private fun performSearch() {
        val pizzaName = searchPizzaNameInput.text.toString().trim()
        val restaurantId = searchRestaurantIdInput.text.toString().trim()

        when {
            // If both fields are empty
            pizzaName.isEmpty() && restaurantId. isEmpty() -> {
                Toast. makeText(this, "Please enter pizza name or restaurant ID", Toast.LENGTH_SHORT).show()
            }
            // Search by restaurant ID with optional pizza name filter
            restaurantId.isNotEmpty() -> {
                searchByRestaurantId(restaurantId, pizzaName)
            }
            // Search by pizza name only
            pizzaName.isNotEmpty() -> {
                searchByPizzaName(pizzaName)
            }
        }
    }

    // Search pizzas by name
    private fun searchByPizzaName(pizzaName: String) {
        lifecycleScope.launch {
            try {
                val pizzas = apiService. searchPizzaByName(pizzaName)
                if (pizzas.isEmpty()) {
                    Toast.makeText(this@MainActivity, "No pizzas found with name: $pizzaName", Toast. LENGTH_SHORT).show()
                }
                adapter.updateData(pizzas)
            } catch (e: Exception) {
                Toast. makeText(this@MainActivity,
                    "Failed to search by name: ${e.message}",
                    Toast.LENGTH_LONG).show()
            }
        }
    }

    // Search pizzas by restaurant ID
    private fun searchByRestaurantId(restaurantId: String, pizzaNameFilter: String = "") {
        lifecycleScope.launch {
            try {
                val pizzas = apiService. searchPizzaByRestaurant(restaurantId)
                
                // Filter by pizza name if provided
                val filteredPizzas = if (pizzaNameFilter.isNotEmpty()) {
                    pizzas. filter { it.name.contains(pizzaNameFilter, ignoreCase = true) }
                } else {
                    pizzas
                }

                if (filteredPizzas.isEmpty()) {
                    Toast.makeText(this@MainActivity, "No pizzas found for restaurant: $restaurantId", Toast.LENGTH_SHORT).show()
                }
                adapter.updateData(filteredPizzas)
            } catch (e: Exception) {
                Toast.makeText(this@MainActivity,
                    "Failed to search by restaurant: ${e.message}",
                    Toast.LENGTH_LONG). show()
            }
        }
    }

    // Fetch menu from API using coroutines
    private fun loadMenu() {
        lifecycleScope.launch {
            try {
                val pizzas = apiService.getMenu()
                val pizzaItems = pizzas.filter { it.category == "Pizza" }
                adapter.updateData(pizzaItems)
                // Clear search inputs when loading all
                searchPizzaNameInput.text?. clear()
                searchRestaurantIdInput.text?.clear()
            } catch (e: Exception) {
                Toast.makeText(this@MainActivity,
                    "Failed to load menu: ${e.message}",
                    Toast.LENGTH_LONG).show()
            }
        }
    }
}
